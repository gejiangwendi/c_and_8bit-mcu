/********************************************************************************************************
File name:		MSP_Page_RX.c
Author:			Lian_Jin
Email:			lian_jin@sonix.com.cn
Date：			2011/10/25
Description:	Page Write 
********************************************************************************************************/

//-------------------------------------------------------------------------------------------------------
#include	"User.h"

#define		RX_Data_Width	8				//数据宽度
uint		Array_RX_Data[8]={0};			//用于存储接收到的数据
extern		uint	ReadData_Buf;

//-------------------------------------------------------------------------------------------------------

/********************************************************************************************************
名	称	：void	MSP_Page_RX(uint RX_Command1,uint RX_Address,uint RX_Command2)

功能描述：读取24C01中从RX_Address开始的8Bytes数据，依次存放在 Array_RX_Data[] 中.
********************************************************************************************************/
void	MSP_Page_RX(uint RX_Command1,uint RX_Address,uint RX_Command2)
{
	uint	i;
//-------------------------------------------------------------------------------------------------------
//	Inital	MSP
//-------------------------------------------------------------------------------------------------------


//-------------------------------------------------------------------------------------------------------
//	Write Device Command
//-------------------------------------------------------------------------------------------------------
	FSEN = 1;							//Enable MSP Start
	while(!FMSPIRQ);
	FMSPIRQ = 0;

	MSPBUF = RX_Command1;
	while(!FMSPIRQ);
	FMSPIRQ = 0;
	if(FACKSTAT)			
	{
		goto EXIT_PAGE_RX; 				
	}		
//-------------------------------------------------------------------------------------------------------	
//	写入要读取的地址
//-------------------------------------------------------------------------------------------------------
	MSPBUF = RX_Address;
	while(!FMSPIRQ);
	FMSPIRQ = 0;
	if(FACKSTAT)			
	{
		goto EXIT_PAGE_RX; 				
	}	
//-------------------------------------------------------------------------------------------------------
//	写入读取指令
//-------------------------------------------------------------------------------------------------------
	FRSEN = 1;							//ReStart
	while(!FMSPIRQ);
	FMSPIRQ = 0;

	MSPBUF = RX_Command2;
	while(!FMSPIRQ);
	FMSPIRQ = 0;
	if(FACKSTAT)			
	{
		goto EXIT_PAGE_RX;  				
	}					
//-------------------------------------------------------------------------------------------------------
//	数据存入ReadData_Buf,并Stop
//-------------------------------------------------------------------------------------------------------	
	for(i=0;i<RX_Data_Width;i++)				 
	{
		FRCEN = 1;
		while(!FMSPIRQ);
		FMSPIRQ = 0;

		if(i !=	(RX_Data_Width-1))
		{
			FACKDT = 0;						//ACK
		}
		else
			FACKDT = 1;			

		FACKEN = 1;
		while(!FMSPIRQ);
		FMSPIRQ = 0;
	
		Array_RX_Data[i] = MSPBUF;
	}
//-------------------------------------------------------------------------------------------------------
//	Stop
//-------------------------------------------------------------------------------------------------------
EXIT_PAGE_RX:

	FPEN = 1;							 
	while(!FMSPIRQ);
	FMSPIRQ = 0;
}