/********************************************************************************************************
File name:		MSP_Page_TX.c
Author:			Lian_Jin
Email:			lian_jin@sonix.com.cn
Date：			2011/10/25
Description:    Page Write 
********************************************************************************************************/

//-------------------------------------------------------------------------------------------------------
#include	"User.h"

#define		TX_Data_Width		8					//需要传输的数据宽度

uint		Array_TX_Data[]={0X12,0X34,0X56,0X78,
						     0X9A,0XAB,0XBC,0XCD};	//需要记录的数据

//-------------------------------------------------------------------------------------------------------

/********************************************************************************************************
 名  称 ：void	MSP_Page_TX(uint TX_Command,uint TX_Address)

功能描述：把Array_TX_Data[]中的数据依次存放在从TX_Address开始的8个连续空间里
********************************************************************************************************/
void	MSP_Page_TX(uint TX_Command,uint TX_Address)	
{
	uint	i;
//-------------------------------------------------------------------------------------------------------
//	Inital	MSP
//-------------------------------------------------------------------------------------------------------
 
 	
//-------------------------------------------------------------------------------------------------------
//	Device Address
//-------------------------------------------------------------------------------------------------------
	FSEN = 1;					//Enable MSP Start
	while(!FMSPIRQ);
	FMSPIRQ = 0;
 
 	MSPBUF = TX_Command;
	while(!FMSPIRQ);
	FMSPIRQ = 0;

	if(FACKSTAT)			
	{
		goto EXIT_PAGE_TX; 				
	}
//-------------------------------------------------------------------------------------------------------
//	等待ACK信号，	Write Address
//-------------------------------------------------------------------------------------------------------
	MSPBUF = TX_Address;	
	while(!FMSPIRQ);				//等待数据或地址发送完毕 
	FMSPIRQ = 0;
	if(FACKSTAT)			
	{
		goto EXIT_PAGE_TX; 				
	}		
//-------------------------------------------------------------------------------------------------------
//	判断数据是否完全写入
//-------------------------------------------------------------------------------------------------------
	for(i=0;i<TX_Data_Width;i++)
	{
		MSPBUF = Array_TX_Data[i];
		while(!FMSPIRQ);			//等待数据或地址发送完毕 
		FMSPIRQ = 0;
		if(FACKSTAT)			
		{
			goto EXIT_PAGE_TX; 				
		}

	}
//-------------------------------------------------------------------------------------------------------
//		Stop 
//-------------------------------------------------------------------------------------------------------			

EXIT_PAGE_TX:				
	
		FPEN = 1;				    //Enable Stop 	
		while(!FMSPIRQ);		 
		FMSPIRQ = 0;	
}