/*******************************************************************************************************
File name:		MSP_Byte_TX.c
Author:			Lian_Jin
Email:			lian_jin@sonix.com.cn
Date：			2011/10/25
Description:	Byte Write 
*******************************************************************************************************/

//-----------------------------------------------------------------------------------------------------
#include	"User.h"
//-----------------------------------------------------------------------------------------------------

/*******************************************************************************************************
 名	称	：void	MSP_Byte_TX(uint TX_Command,uint TX_Address,uint TX_Data)

功能描述：把数据TX_Data写入到TX_Address中
*******************************************************************************************************/
void	MSP_Byte_TX(uint TX_Command,uint TX_Address,uint TX_Data)
{
//------------------------------------------------------------------------------------------------------
//	Inital	MSP
//------------------------------------------------------------------------------------------------------

//------------------------------------------------------------------------------------------------------
//	Device Address
//------------------------------------------------------------------------------------------------------
	FSEN = 1;					//Enable MSP Start
	while(!FMSPIRQ);
	FMSPIRQ = 0;
 
 	MSPBUF = TX_Command;
	while(!FMSPIRQ);
	FMSPIRQ = 0;

	if(FACKSTAT)			
	{
		goto EXIT_TX; 				
	}							 	
//-------------------------------------------------------------------------------------------------------
//	等待ACK信号，	Write Address
//-------------------------------------------------------------------------------------------------------
	MSPBUF = TX_Address;	
	while(!FMSPIRQ);				//等待数据或地址发送完毕 
	FMSPIRQ = 0;
	if(FACKSTAT)			
	{
		goto EXIT_TX;  				
	}			
//-------------------------------------------------------------------------------------------------------
//	判断数据是否完全写入
//-------------------------------------------------------------------------------------------------------
	MSPBUF = TX_Data;
	while(!FMSPIRQ);			//等待数据或地址发送完毕 
	FMSPIRQ = 0;
	if(FACKSTAT)		
	{
		goto EXIT_TX;  				
	}	
//-------------------------------------------------------------------------------------------------------
//		Stop 
//-------------------------------------------------------------------------------------------------------			

EXIT_TX:
	FPEN = 1;	
	while(!FMSPIRQ);		 
	FMSPIRQ = 0;
}

	


